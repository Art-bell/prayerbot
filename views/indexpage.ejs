<html>
<head>
<title></title>
<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
    <style type="text/css">
        #holder {
                width: 93vw;
                height: 90vh;
                border: 1px solid silver;

                margin: auto;
                position: relative;
                border-radius: 20px;
        }
        h3 {
            background: #36D1DC;  /* fallback for old browsers */
background: -webkit-linear-gradient(to right, #5B86E5, #36D1DC);  /* Chrome 10-25, Safari 5.1-6 */
background: linear-gradient(to right, #5B86E5, #36D1DC); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */

            -webkit-margin-before: 0em;
            -webkit-margin-after: 0em;
            font-family: 'Lato';
            font-weight: 300;
            color: white;
            height: 60px;
            text-align: left;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            padding-top: 10px;
            text-align: center;
            font-size: 40px;
        }
        input {
            position: absolute;
            bottom: 0;
            outline: none !important;
            width: 85%;
            left: 0;
            height: 80px;
            font-size: 40px;
            border-bottom-left-radius: 20px;
            padding: 10px;
            border: none;
            border-top: 1px solid silver;
            transition: 0.2s;
        }
        input:focus{
          box-shadow: 0 0 5px coral;
          border: 1px solid coral;
          border-bottom-left-radius: 20px;
        }
        #content {
            overflow: auto;
            width: 98.5%;
            height: 79vh;
            background: whitesmoke;
            padding: 10px;
        }
        
        .chatbot {
            text-align: left;
            margin: 10px;
        }
        .chatbotspan {
                font-size: 40px;
                background: white;
                color: black;
                padding: 10px;
                border-radius: 5px;
                font-family: 'Lato';
                font-weight: 300;
                max-width: 55%;
                text-align: left;
                display: inline-block;
                -webkit-margin-before: 0;
                -webkit-margin-after: 0;
        }
        .user {
            text-align: right;
            margin: 10px;

        }
        ul {
                padding: 0;
                text-align: left;
                -webkit-margin-before: 0;
                -webkit-margin-after: 0;
                margin: 10px;
        }
        li {
                background: white;
                display: inline-block;
                color: black;
                padding: 10px;
                border-radius: 5px;
                font-family: 'Lato';
                font-weight: 300;
                max-width: 55%;
                padding: 10px;
        }
        /*.user::after {
                content: "";
                position: absolute;
                border-bottom: 10px solid transparent;
                border-left: 28px solid #824F5D;
                right: 0px;
        }*/
        .userspan {
            font-size: 40px;
            background: #469BB8;
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Lato';
            font-weight: 300;
            max-width: 55%;
            text-align: left;
            display: inline-block;
            -webkit-margin-before: 0;
            -webkit-margin-after: 0;
        }
        .action {
            color: white;
            padding: 10px 20px 10px 20px;
            border: none;
            font-family: sans-serif;
            border-radius: 20px;
            width: 40%;
            background: #824F5D;
            margin-top: 10px;
            font-size: 40px;
            display: inline-block;
            border-radius: 230px;
            width: 300px;
            height: 300px;
            vertical-align: top;
            overflow-y: hidden;
            overflow-x: hidden;
        }
        #go {
            background-color: cornflowerblue;
            width: 14.9%;
            right: 0;
            border: none;
            position: absolute;
            bottom: 0;
            color: white;
            height: 80px;
            border-bottom-right-radius: 20px;
        }
        .img_span {
            margin-bottom: 5px;
            display: inline-block;
            width: 100%; text-align: center;
            border-bottom: 1px solid maroon;
        }
        #option_content {
            overflow-x: auto; 
            width: 
        }
        .top_layer {
            background: white;
            height: 175px;
            margin: auto; 
            text-align: center;
            width: 404px;
            transform: translateY(-10px) translateX(-50px);
        }
        a:visited {
            color: green;
        }
        .option { 
        	padding: 15px 20px 15px 20px; border:none;
        	border-radius: 25px; 
        	font-size: 18px; 
        	margin: 10px; 
        	color: #fff;
        	background: #469BB2;
        	width: 220px;
        }
        .options_holder{
        	overflow-x: auto;
        }
        .verse {
            cursor: pointer;
            color: #176D8A;
        }
        .horizontal_move{
        	min-width: 200px;
        	display: inline-flex;
        }
        #popup_modal {
            border: 1px solid silver;
            height: 400px; overflow-x: scroll;  
            padding: 40px 20px ; 
            width: 60%; 
            display: none; 
            background: white; 
            position: fixed; 
            z-index: 2; 
            left: 50%; 
            margin-left: -30%; 
            margin-top: 150px;
            font-family: Verdana;
        }
        #exit {
            float: right;
            cursor: pointer;
        }
        #header_holder {

        }
        #popup_text {
            text-align: center;
            font-family: 'Lato';
            font-weight: 400
        }
        #popup_header{
            display: inline-block;
        }
        @media (min-width:1025px) { #content {
            overflow: auto;
            width: 98.5%;
            height: 70vh;
            background: whitesmoke;
            padding: 10px;
        } }
        @media (min-width:1281px) { #content {
            overflow: auto;
            width: 98.5%;
            height: 70vh;
            background: whitesmoke;
            padding: 10px;
        } }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type ="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type ="text/javascript">

        //the block below is used to hide the 'pop-up verse' div once the user clicks out of the div
        $(document).mouseup(function(e) 
        {
            var container = $("#popup_modal");

            // if the target of the click isn't the container nor a descendant of the container
            if (!container.is(e.target) && container.has(e.target).length === 0) 
            {
                container.hide();
            }
        });

        $(document).ready(function (){
            var socket = io.connect(); //Socket connection

            //Once the page is loaded, emit 'on_load'. This causes the server to send the 'problem' options to the user at the beginning
            socket.emit("on_load", {reason: ""});
            $('#exit').click(function(){
                $('#popup_modal').fadeOut(300, function(){
                    $('#popup_text').text("")
                });

            })
        	var search_flag = false;   //This is the search flag. the search flag is used to indicate when the user will use the text input box to search through given options. It is set to true when the server send 'problem' options to the user.

            //Once an option is clicked, this block will execute.
        	$('body').on('click', '.option', function(){
        		search_flag =false    //The search flag will be reset to false since the option has already been clicked
            	// $('button').prop('disabled', 'disabled');
                $('#content').append("<div class='user'><span class='userspan'>"+$(this).text()+"</span></div>");//The selected option will be sent into the chat as if it were typed by the user.
                
                socket.emit("option", {reason: $(this).text()}); //send the option to the server
                $('.options_holder').hide(); //hold the entire options list
                $('input').val(""); //clear the text input box
                objDiv.scrollTop = objDiv.scrollHeight;
        	})
            //The block below will execute when the bible verse is clicked
            $('body').on('click', '.verse', function(){ 
                $('#popup_modal').fadeIn(300);//Display the pop up modal where the entire bible chapter will be displayed
                $('#popup_header').text($(this).text().split(":")[0])   //Make the header of this pop up equal to the chapter that was clicked
                socket.emit("get_verse", {reason: $(this).text()}); //Send a request to the server to get the needed bible chapter
                $('#popup_text').append("<img id='loading' src='https://www.mts.am/ResourcePackages/MTSArmenia/assets/images/loading.gif' >")
                //Append the loading image so the user knows to wait
            })
        	var objDiv = document.getElementById("content");   //Get the entire chat message box
            
            //The function below is used to send the users message to the server
            function sendtext() {
            	$('button').prop('disabled', 'disabled');
                $('#content').append("<div class='user'><span class='userspan'>"+$('input').val()+"</span></div>");
                
                socket.emit("user_sent", {reason: $('input').val()});
                $('input').val("");
                
                objDiv.scrollTop = objDiv.scrollHeight;
            }

        	
            //When the 'enter' button is pressed, send the text to the server
            $('input').keypress(function(e) {
                if(e.which == 13) {
                    if($('input').val() != "" && $('input').val() != " "){
                        $('.options_holder').hide();
                        sendtext()

                        }
                    }
            });
            //If the 'go/send' button is pressed, send text to the server
             $('#go').click(function (){
                if($('input').val() != "" && $('input').val() != " "){
                    $('.options_holder').hide();
                    sendtext()
                }
            });

            //The function here captures whenever the user types anything into the text input boz
	    	$('.text_box').on('input',function(e){
	    		if (search_flag == true){//If the search flag is active while the user is typing, make the text input act as a search for the available options.
	    			var elementcount = 0;
	    			var display_none_count = 0;
	        		$('.option').each(function() {
	        			elementcount++;
	            		if($(this).text().toLowerCase().includes($('.text_box').val()) == false){
	            			$(this).css('display', 'none');
	            		}
	            		else{
	            			$(this).css('display', 'inline-block');
	            			$('.nothing_found').remove()
	            		}

	            		if ($(this).css('display') == 'none'){
	            			display_none_count++
	            		}

	            	})
                    //If the users search doesnt yield any results, then a 'sorry' message is displayed instead
	            	if (display_none_count == elementcount && $(".horizontal_move").find(".nothing_found").length == 0){
	            			$('.horizontal_move').append("<p class='nothing_found'>Sorry, no result has been found</p>")
	            	}
	        	}
	    	})
	            	
            
                socket.on('server_response', function (data){
                    $('button').prop('disabled', false);
                    $('#content').append("<div class='chatbot'><p class='chatbotspan'>"+data.response+"</p></div>");
                    // $('#loading').remove();
                    objDiv.scrollTop = objDiv.scrollHeight; 
                });
                socket.on('button_options', function(data){
                	search_flag = true;
                	$('#content').append(data.response)
                })
                socket.on('returned_verses', function(data){
                    $('#popup_text').text("")
                    $('#popup_text').append(data.response)
                })
        })

    </script>
</head>
<body>
    <div id="holder">

        <h3><span style="vertical-align: top; margin-left: 10px;">PrayerBot</span></h3>
        <div id="content">
            <div id="popup_modal">
                <div id='header_holder'>
                    <h2 id="popup_header"></h2>
                    <span id="exit">X</span>
                </div>
                <p id="popup_text"></p>
            </div>
            <div class="chatbot"> 
                <p class="chatbotspan">Good day </p>
            </div>
            <!-- <div class="chatbot"> <p class="chatbotspan">Click one of these to find out something new  &#128521;</p></div> -->
           
        </div>
        <input class="text_box" placeholder="Send a message" maxlength="80" type="text">
        <button id="go">
            <svg fill="white" version="1.1" xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 512 512">
            <title></title>
            <g id="icomoon-ignore">
            </g>
            <path d="M288 124.186v-124.186l192 192-192 192v-126.912c-223.375-5.241-213.794 151.896-156.93 254.912-140.356-151.707-110.55-394.785 156.93-387.814z"></path>
            </svg>
        </button>
    </div>
    <!-- web page goes here -->
</body>
</html><br>